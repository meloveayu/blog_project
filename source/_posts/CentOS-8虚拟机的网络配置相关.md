---
title: CentOS 8虚拟机的网络配置相关
date: 2020-05-14 15:31:58
categories: 学习笔记
tags:
  - linux
  - 虚拟机
---

这部分只解决在 VMWare Workstation 上安装完 CentOS 8 后的网络问题，即第一无法访问外界网络，第二无法与宿主机联通。这部分可以自行用`ping`判断是否有这两个问题。

<!--more-->

1. 首先要把虚拟机的网络连接模式设置成桥接模式，然后用`ifconfig`命令查看一下虚拟机是否有配置 IP 地址以及掩码设置等（以下的操作均在 root 下进行），大概率没有配置。
2. 在 VMWare 的工具栏里的编辑中选择虚拟网络编辑器，设定连接的哪一张网卡，这一部分要把 VMnet0 项选择为桥接模式连接到自己的宿主机的可用网卡上，参考网上文章，可选自动使用。个人是绑到了常用的无线网卡上。
3. 使用`dhclient`为虚拟机分配可用的 IP 地址与掩码，可以用`ifconfig`查看后记下来，一会儿要用。
4. 修改`/etc/sysconfig/network-scripts/ifcfg-ens33`文件，修改以下的几项：（基于本人的操作，其他人或者有所不同）
   > 将 BOOTPOROTO 的之后修改为 static
   > ONBOOT 的之后修改为 yes
   > 添加 IPADDR=x.x.x.x 此处添加的即为之前分配的 IP 地址
   > 添加 NETMASK=x.x.x.x 此处添加的是之前的掩码
   > 添加 GATEWAY=x.x.x.x 此处添加的是网关，应和宿主机一致，可使用相关指令在宿主机查找
   > 添加 DNS1=x.x.x.x 此处添加 DNS 服务器地址，也和宿主机一致（这里本人的宿主机没有 DNS 的相关信息，似乎填上常用的即可，存疑）
5. 重启网络设置，相比之前版本 CentOS 8 修改了网络管理的相关指令，使用`nmcli c reload`重启网络服务即可。可用`ping`指令检查是否能够联通外界网络与宿主机。

遗留的问题：个人测试虚拟机连接宿主机无法 ping 通，但是宿主机可以 ping 通虚拟机，宿主机也可以使用 SSH 访问到虚拟机界面，似乎并没有什么问题……

上面问题的回答（补充于8月5日）：是Windows 10 防火墙的问题，最直接的方式就是把防火墙关了，稍微高级的方法是防火墙高级规则配置入站规则允许虚拟机IPv4可进入，但是这个问题似乎是在桥接模式下存在的，之后改成NAT连接后，把防火墙配置改回去也没有问题了。

多节点的配置可以直接克隆再重新配置网络即可，问题不大。

补充：按照上面的配置方法，桥接模式加静态IP的弊端就是当宿主机的网络环境变了之后，就不能网络访问虚拟机了，可以改成NAT连接模式。我参考了https://www.cnblogs.com/Stephen-Qin/p/12889358.html这篇文章里的方法进行了配置，最后效果很好。感谢博主。